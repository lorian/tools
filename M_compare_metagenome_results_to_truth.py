# Compare express-calculated abundances to actual abundances in a metagenomic test dataset

import sys
import csv
import numpy as np

np.set_printoptions(precision=4)

filename = sys.argv[1]
print filename
dataset = sys.argv[2] # which dataset to compare against

if dataset == 'simLC':
	dataset = np.array(zip(*[
("Actinobacillus_succinogenes_130Z",0.49),
("Alkalilimnicola_ehrlichii_MLHE-1",0.52),
("Alkaliphillus_metalliredigenes_UNDEF",0.45),
("Anabaena_variabilis_ATCC_29413",0.61),
("Anaeromyxobacter_dehalogenans_2CP-C",0.53),
("Arthrobacter_sp._FB24",0.55),
("Azotobacter_vinelandii_AvOP",0.55),
("Bacillus_cereus_NVH391-98",0.58),
("Bifidobacterium_longum_DJO10A",0.55),
("Bradyrhizobium_BTAi1",5.08),
("Brevibacterium_linens_BL2",0.56),
("Burkholderia_ambifaria_AMMD",0.58),
("Burkholderia_cenocepacia_AU_1054",0.55),
("Burkholderia_cenocepacia_HI2424",0.57),
("Burkholderia_sp._sp.strain_383",1.35),
("Burkholderia_vietnamiensis_G4",0.61),
("Burkholderia_xenovorans_LB40",0.53),
("Caldicellulosiruptor_accharolyticus_UNDEF",0.56),
("Chlorobium_limicola_DSMZ_245(T)",0.62),
("Chlorobium_phaeobacteroides_DSM_266",0.52),
("Chlorobium_vvibrioforme_f._thiosulfatophilum_DSMZ_265(T)",0.46),
("Chloroflexus_aurantiacus_J-10-fl",0.58),
("Chromohalobacter_salexigens_DSM3043",0.56),
("Clostridium_beijerincki_NCIMB_8052",0.56),
("Clostridium_thermocellum_ATCC_27405",0.54),
("Crocosphaera_watsonii_WH_8501",0.59),
("Cytophaga_hutchinsonii_ATCC_33406",5.27),
("Dechloromonas_aromatica_RCB",0.54),
("Deinococcus_geothermalis_DSM_11300",0.76),
("Desulfitobacterium_hafniense_DCB-2",0.66),
("Desulfovibrio_desulfuricans_G20",0.59),
("Ehrlichia_canis_Jake",0.67),
("Ehrlichia_chaffeensis_sapulpa",0.67),
("Enterococcus_faecium_DO",0.6),
("Exiguobacterium_UNDEF_255-15",0.56),
("Ferroplasma_acidarmanus_fer1",0.55),
("Frankia_sp._CcI3",0.54),
("Frankia_sp._EAN1pec",0.56),
("Geobacter_metallireducens_GS-15",0.58),
("Haemophilus_somnus_129PT",0.52),
("Jannaschia_sp._CCS1",0.57),
("Kineococcus_radiotolerans_SRS30216",0.54),
("Lactobacillus_brevis_ATCC_367",0.35),
("Lactobacillus_casei_ATCC_334",0.57),
("Lactobacillus_delbrueckii_bulgaricus_ATCC_BAA-365",0.48),
("Lactobacillus_gasseri_ATCC_33323",0.58),
("Lactococcus_lactis_cremoris_SK11",0.56),
("Leuconostoc_mesenteroides_mesenteroides_ATCC_8293",0.52),
("Magnetococcus_sp._MC-1",0.48),
("Marinobacter_aquaeolei_VT8",0.57),
("Mesorhizobium_sp._BNC1",0.58),
("Methanococcoides_burtonii_DSM6242",0.47),
("Methanosarcina_barkeri_Fusaro",0.51),
("Methanospirillum_hungatei_JF-1",0.55),
("Methylobacillus_flagellatus_strain_KT",0.56),
("Moorella_thermoacetica_ATCC_39073",1.16),
("Nitrobacter_hamburgensis_UNDEF",0.65),
("Nitrobacter_winogradskyi_Nb-255",0.57),
("Nitrosococcus_oceani_UNDEF",0.53),
("Nitrosomonas_eutropha_C71",0.53),
("Nitrosospira_multiformis_ATCC_25196",0.54),
("Nocardioides_sp._JS614",0.58),
("Novosphingobium_aromaticivorans_DSM_12444_(F199)",0.66),
("Oenococcus_oeni_PSU-1",0.46),
("Paracoccus_denitrificans_PD1222",0.58),
("Pediococcus_pentosaceus_ATCC_25745",0.54),
("Pelobacter_carbinolicus_DSM_2380",0.6),
("Pelobacter_propionicus_DSM_2379",0.57),
("Pelodictyon_luteolum_UNDEF",0.48),
("Pelodictyon_phaeoclathratiforme_BU-1_(DSMZ_5477(T))",0.6),
("Polaromonas_sp._JS666",0.64),
("Prochlorococcus_marinus_str._MIT_9312",0.48),
("Prochlorococcus_sp._NATL2A",0.62),
("Prosthecochloris_aestuarii_SK413/DSMZ_271(t)",0.51),
("Prosthecochloris_sp._BS1",0.8),
("Pseudoalteromonas_atlantica_T6c",0.51),
("Pseudomonas_fluorescens_PfO-1",0.51),
("Pseudomonas_putida_F1",0.51),
("Pseudomonas_syringae_B728a",0.55),
("Psychrobacter_arcticum_273-4",0.56),
("Psychrobacter_cryopegella_UNDEF",0.62),
("Rhodobacter_sphaeroides_2.4.1",0.56),
("Rhodoferax_ferrireducens_UNDEF",0.58),
("Rhodopseudomonas_palustris_BisA53",0.52),
("Rhodopseudomonas_palustris_BisB18",0.57),
("Rhodopseudomonas_palustris_BisB5",0.53),
("Rhodopseudomonas_palustris_HaA2",24.49),
("Rhodospirillum_rubrum_ATCC_11170",0.58),
("Rubrobacter_xylanophilus_DSM_9941",0.57),
("Saccharophagus_degradans_2-40",0.52),
("Shewanella_amazonensis_SB2B",0.56),
("Shewanella_baltica_OS155",0.55),
("Shewanella_frigidimarina_NCMB400",0.51),
("Shewanella_putefaciens_UNDEF",0.55),
("Shewanella_sp._ANA-3",0.6),
("Shewanella_sp._MR-7",0.54),
("Shewanella_sp._PV-4",0.52),
("Shewanella_sp._W3-18-1",0.51),
("Silicibacter_sp._TM1040",0.66),
("Sphingopyxis_alaskensis_RB2256",0.59),
("Streptococcus_suis_89/1591",0.56),
("Streptococcus_thermophilus_LMD-9",0.43),
("Synechococcus_sp._PCC_7942_(elongatus)",0.53),
("Syntrophobacter_fumaroxidans_MPOB",0.55),
("Syntrophomonas_wolfei_Goettingen",0.48),
("Thermoanaerobacter_ethanolicus_39E",0.6),
("Thermobifida_fusca_YX",0.54),
("Thiobacillus_denitrificans_ATCC_25259",0.61),
("Thiomicrospira_crunogena_XCL-2",0.51),
("Thiomicrospira_denitrificans_ATCC_338890",0.57),
("Trichodesmium_erythraeum_IMS101",0.57),
("Xylella_fastidiosa_Ann-1",2.51),
("Xylella_fastidiosa_Dixon",1.04)
]))
elif dataset == 'i100':
	dataset = np.array(zip(*[
("acinetobacter_baumannii_sdf",0.99),
("alkalilimnicola_ehrlichii_mlhe-1",0.95),
("alkaliphilus_metalliredigens_qymf",1.03),
("anabaena_variabilis_atcc_29413",0.87),
("bacillus_anthracis_str._ames",1.06),
("bacillus_cereus_atcc_10987",0.91),
("bacillus_cereus_atcc_14579",1.46),
("bacillus_cereus_e33l",0.91),
("bacillus_clausii_ksm-k16",0.9),
("bacillus_halodurans_c-125",0.88),
("bacillus_subtilis_subsp._subtilis_str._168",0.88),
("bacillus_thuringiensis_str._al_hakam",0.95),
("bacteroides_thetaiotaomicron_vpi-5482",0.87),
("bordetella_bronchiseptica_rb50",1.2),
("borrelia_garinii_pbi",1.13),
("buchnera_aphidicola_bcc",0.87),
("burkholderia_phymatum_stm815",1.05),
("burkholderia_pseudomallei_668",0.9),
("campylobacter_concisus_13826",1.04),
("candidatus_blochmannia_pennsylvanicus_str._bpen",0.91),
("chlamydia_trachomatis_l2b/uch-1/proctitis",0.96),
("chlamydophila_caviae_gpic",0.87),
("chlamydophila_pneumoniae_cwl029",0.88),
("chlorobium_luteolum_dsm_273",0.96),
("chromobacterium_violaceum_atcc_12472",0.97),
("clostridium_beijerinckii_ncimb_8052",0.95),
("clostridium_botulinum_b1_str._okra",1.16),
("clostridium_novyi_nt",0.93),
("clostridium_thermocellum_atcc_27405",1.03),
("corynebacterium_efficiens_ys-314",1),
("corynebacterium_urealyticum_dsm_7109",0.92),
("coxiella_burnetii_rsa_493",0.94),
("cyanothece_sp._atcc_51142",0.96),
("cytophaga_hutchinsonii_atcc_33406",1.1),
("erwinia_tasmaniensis",0.91),
("escherichia_coli_apec_o1",0.92),
("escherichia_coli_e24377a",0.98),
("escherichia_coli_str._k-12_substr._mg1655",1.29),
("escherichia_coli_str._k-12_substr._w3110",0.88),
("francisella_tularensis_subsp._tularensis_fsc198",0.88),
("geobacter_sulfurreducens_pca",0.89),
("haemophilus_influenzae_rd_kw20",0.94),
("haemophilus_somnus_129pt",0.97),
("haloquadratum_walsbyi_dsm_16790",0.87),
("herpetosiphon_aurantiacus_dsm_785",0.98),
("hyphomonas_neptunium_atcc_15444",0.91),
("idiomarina_loihiensis_l2tr",0.93),
("ignicoccus_hospitalis_kin4/i",1.18),
("lactobacillus_delbrueckii_subsp._bulgaricus_atcc_baa-365",0.9),
("lactobacillus_salivarius_ucc118",0.94),
("lactococcus_lactis_subsp._cremoris_sk11",1.39),
("lactococcus_lactis_subsp._lactis_il1403",0.92),
("lawsonia_intracellularis_phe/mn1-00",0.86),
("leptospira_borgpetersenii_serovar_hardjo-bovis_jb197",0.89),
("listeria_welshimeri_serovar_6b_str._slcc5334",0.95),
("methanococcus_maripaludis_c7",0.89),
("mycobacterium_avium_subsp._paratuberculosis_k-10",0.9),
("mycobacterium_bovis_af2122/97",0.88),
("mycobacterium_marinum_m",1.77),
("mycobacterium_sp._jls",0.9),
("mycobacterium_tuberculosis_f11",0.99),
("neisseria_gonorrhoeae_fa_1090",0.93),
("neisseria_meningitidis_mc58",0.9),
("nostoc_punctiforme_pcc_73102",1.02),
("ochrobactrum_anthropi_atcc_49188",0.93),
("prochlorococcus_marinus_str._mit_9313",1.01),
("prochlorococcus_marinus_str._natl1a",0.97),
("pseudomonas_putida_w619",1.25),
("pseudomonas_stutzeri_a1501",0.89),
("psychrobacter_cryohalolentis_k5",2.23),
("psychromonas_ingrahamii_37",0.87),
("ralstonia_eutropha_h16",0.89),
("rhodococcus_jostii_rha1",0.88),
("rhodopseudomonas_palustris_bisa53",1.07),
("rhodopseudomonas_palustris_cga009",1.01),
("rickettsia_prowazekii_str._madrid_e",0.89),
("salmonella_enterica_subsp._enterica_serovar_paratyphi_b_str._spb7",1.11),
("shewanella_sp._mr-7",0.9),
("sinorhizobium_meliloti_1021",0.87),
("sodalis_glossinidius_str._'morsitans'",0.94),
("staphylococcus_aureus_subsp._aureus_jh1",1.14),
("staphylococcus_aureus_subsp._aureus_mrsa252",0.88),
("staphylococcus_aureus_subsp._aureus_mu3",0.86),
("staphylococcus_aureus_subsp._aureus_mw2",1.09),
("staphylococcus_aureus_subsp._aureus_nctc_8325",0.88),
("staphylococcus_aureus_subsp._aureus_str._newman",0.98),
("streptococcus_agalactiae_2603v/r",1.05),
("streptococcus_pneumoniae_r6",1.22),
("streptococcus_pyogenes_mgas315",0.87),
("streptococcus_pyogenes_mgas5005",1.02),
("synechococcus_elongatus_pcc_6301",0.87),
("synechococcus_elongatus_pcc_7942",1.58),
("syntrophomonas_wolfei_subsp._wolfei_str._goettingen",0.91),
("thermosipho_melanesiensis_bi429",0.92),
("thermus_thermophilus_hb8",1),
("thiobacillus_denitrificans_atcc_25259",1.08),
("treponema_denticola_atcc_35405",0.89),
("ureaplasma_parvum_serovar_3_str._atcc_700970",0.87),
("wigglesworthia_glossinidia_endosymbiont_of_glossina_brevipalpis",1.33),
("yersinia_pestis_co92",0.92)
]))

true_species = dataset[0]
true_abundance = np.array([float(i) for i in dataset[1]])

results_file = open(filename,'r')
results = csv.reader(results_file, 'excel-tab')
results_data = [r for r in results]
results_data = results_data[1:]
results_data.sort(key=lambda x:x[1])

species = zip(*results_data)[1]
fpkm = np.array([float(i) for i in zip(*results_data)[10]])
fpkm_total = np.sum(fpkm)
fpkm_abundance = fpkm*100/fpkm_total
print fpkm_abundance
diff = 100*abs(true_abundance - fpkm_abundance)/true_abundance
print "Average relative error: {0}".format(np.mean(diff))
diff_sq = [d*d/10000 for d in diff]
print "Relative root mean squared error: {0}".format(np.mean(diff_sq) ** (0.5) * 100)
